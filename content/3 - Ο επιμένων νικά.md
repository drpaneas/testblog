Title: Ο επιμένων νικά!
Date: 2015-01-017 04:41
Tags: fritz-box
Category: Editorial
Slug: o-epimenon-nika
Author: Πανος Γεωργιαδης

Η ώρα είναι 4:09, ξημερώματα και βρίσκομαι στην Γερμανία. Η Αλεξάνδρα κοιμάται δίπλα στο δωμάτιο και εγώ βρίσκομαι στο σαλόνι γράφοντας αυτό το άρθρο στον `vim`. Από κάτω ακούγονται διάφοροι *μεθυσμένοι* Γερμανοί, καθώς υπάρχει ένα μπαρ που ανοίγει σχετικά αργά. Βλέπετε, αύριο (*δηλαδή σήμερα*) είναι Σάββατο, οπότε του *δίνουν και καταλαβαίνει*. Τέλος πάντων, το ερώτημα είναι γιατί ... Γιατί δεν κοιμάμαι;

## Πρόβλημα στο Fritzbox

Η σύνδεση που έχω στο Internet είναι VDSL 50, με πάροχο την [1-und-1](http://1und1.de), η οποία είναι θυγατρική της Deutsche Telekom. Το Router που μου έδωσαν είναι ένα **Fritz!Box 7362 SL**, το οποίο κανονικά στοιχίζει περίπου [125 Ευρώ](http://www.amazon.de/Fritz-Box-7362SL-FritzBox-7362/dp/B00G472F6K) στο Amazon. Γενικά είμαι πολύ ευχαριστημένος από το Internet εδώ. Το μόνο μου πρόβλημα είναι ότι το Macbook δεν δουλεύει καλά με τον driver όταν το WLAN έχει WPA2 (only) security, αλλά ... τι να κάνεις! Αυτά έχει η *Apple*.

Στις 00:05 (περίπου) χτυπάει το κινητό μου. Ήταν η θεία μου που μένει στο Sindelfingen:

> Πάνο, τι έπαθε το τηλέφωνό σας; Σας παίρνω τηλέφωνο αλλά δεν χτυπάει.

Όντως, σηκώνω το ακουστικό και δεν ακούω τίποτα. Πηγαίνω μέσα στο Fritz!box και βλέπω να αναβοσβήνει το κόκκινο LED (info). Βλέπετε, το τηλέφωνο εδώ είναι VOIP, και έχω 3 *Rufnummem*, τα οποία μπορώ να κάνω *forward* στο κινητό μου. Δηλαδή αν με παίρνεις στο σταθερό, μπορώ να το τροποιήσω ώστε να χτυπάει και το κινητό (εφόσον είναι στο Internet) ώστε να μην χάνω καμία κλήση. Ένα επιπλέον θετικό από την ιστορία του VOIP, είναι ότι κρατάει τις κλήσεις στα log files, και μπορεί να στα κάνει export σε `CSV` format το οποίο μπορεί να το κάνεις `import` όπου θες και να βγάλεις κάποια άκρως ενδιαφέροντα γραφήματα/συμπεράσματα για τις κλήσεις σου!

### Troubleshooting A'
Το πρώτο πράγματα που κάνω συνήθως είναι ένα **reset**. Με μία γρήγορη ματιά δεν είδα να έχει κάποιο κουμπί, οπότε έβγαλα απλά την πρίζα. Περίμενα κανά λεπτό, και την σύνδεσα ξανά, ενώ παράλληλα έβλεπα τα LEDs του Fritz!Box. Στην αρχή, ανάβουν όλα μαζί (ταυτόχρονα), στην συνέχεια αρχίζει να κάνει blinking το **Power** και μετά απο λίγο ... ανάβει (πάλι) το κόκκινο LED.

### Troubleshooting B'
Δεύτερη κίνηση, για να εξακριβώσω αν φταίει το router ή η γραμμή, είναι να βγάλω όλα τα καλώδια από το Fritz!Box. Η αλήθεια είναι ότι εδώ οι Γερμανοί έχουν περίεργα βύσματα, οπότε *just to be on the safe side of things*, ξήλωσα τα πάντα και άφησα μόνο το καλώδιο της τροφοδοσίας. Βγάζω - βάζω το ρεύμα ... πάλι τα ίδια αποτελέσματα. Τουλάχιστον μάθαμε κάτι:

> Φταίει το Router (η συσκευή).

### Troubleshooting Γ'
Φέρνω λοιπόν το Fritz!Box στο σαλόνι και το βάζω στην πρίζα. Ψάχνω να βρώ το `WLAN SSID` μου, αλλά "πουθενά". Προφανώς λοιπόν, το Router δεν έχει καταφέρει να μπουτάρει. Για να είμαστε 100% σίγουροι, σκέφτηκα να το συνδέσω ενσηρματα με το Macbook Air. Ευτυχώς, πριν φύγω από Ελλάδα, αγόρασα έναν θαυματουργό Thunderbolt το Ethernet μετατροπέα, ο οποίος φαίνεται ότι δουλεύει μια χαρά. Δυστυχώς στην περίπτωσή μου, η κάρτα δικτύου του Mac δεν μπορούσε να πάρει IP. Ωστόσο, μάθαμε κάτι:

> Δεν μπορώ να επικοινωνήσω με το Router...

### Troubleshooting Δ'
Η επόμενη κίνηση είναι να ψάξουμε για το γνωστό σημείο, στο οποίο χωράει μία οδογλυφίδα ή η μύτη ενός στυλό, ώστε να κάνουμε **hard reset**, ελπίζοντας πως η επαναφορά των εργοστασιακών ρυθμήσεων θα λύσει το πρόβλημα του κόκκινου LED. Δεν ξέρω πως τους ξέφυγε αυτή η κατασκευαστική λεπτομέρεια, αλλά πρέπει να ομολήσω ότι πρέπει να είναι τελείως **ηλίθιος** αυτός που ξέχασε να βάλει ένα hard-reset button στο Fritz!Box. Θέλω να πω, το routerάκι είναι *τούμπανο*, μέχρι και ενσωματωμένο *NAS* έχει πάνω.... *πόσο δύσκολο ήταν να βάλουν ένα recovery button*...

Τι θα κάνω τώρα; Μήπως να πάω να κοιμηθώ; Χα! *The night is young*. Πρέπει με κάποιον τρόπο να φορτώσω το εργοστασιακό Firmware, αλλά δεν έχω Internet...

## Android Tethering / Hotspot
Να ναι καλά το Android και το κινέζικο κινητό μου, πήγα στις ρυθμήσεις, άνοιξα το 3G και έβαλα το κινητό να εκτελεί καθήκοντα Wifi, δηλαδή να μοιράζει Internet στο δίκτυο ασύρματα. Οπότε συνδέθηκα με το Macbook και ξεκίνησα το `googling`. Σε λίγα δευτερόλεπτα είχα ήδη βρει το επίσημο troubleshooting για το πρόβλημα μου:[Problem when updating FRITZ!OS: Info LED flashes constantly](http://en.avm.de/nc/service/fritzbox/fritzbox-7390/knowledge-base/publication/show/77_Problem-when-updating-FRITZ-OS-Info-LED-or-several-LEDs-flash-constantly/). Η λύση που προτίνεται εδώ είναι να κατεβάσουμε το [νέο firmware](ftp://ftp.avm.de/fritz.box/fritzbox.7362_sl/firmware/deutsch/).

Και; Πώς θα το `φλασάρω` ρε ξάδερφε; Αφού δεν μπορώ να επικοινωνήσω με το Router. Για καλή μου τύχη λοιπόν, υπάρχει ένα ειδικό εργαλείο από την εταιρεία, η οποία παρέχει ένα **recovery reset tool** για κάθε Fritz!Box μοντέλο. Ετσι λοιπόν, [ανοίγω το νέο tab](http://en.avm.de/nc/service/fritzbox/fritzbox-7390/knowledge-base/publication/show/160_Restoring-FRITZ-OS-of-the-FRITZ-Box/) με τις πληροφορίες και βλέπω ότι το εργαλειο είναι συμβατό **μόνο με Microsoft Windows XP**....

> Γαμ.. @*&^&$@*$*@&^@#$@$

Για κακή μου τύχη, πριν λίγες μέρες είχα σβήσει το *VMWare image των Windows 7* από τον SSD, γιατί δεν είχα πολύ χώρο. Ενώ θα μπορούσα -- *ο ηλίθιος* -- να το πάρω **backup** στον εξωτερικό σκληρό, ο οποίος είναι **3 TB**, βαρέθηκα να σηκωθώ από τον καναπέ, και δεν το έκανα. *Καλά να πάθω!*

+ Lesson Learned: Πρέπει να στήσω `ownCloud` asap!

Αφού κατέβασα λοιπόν το [recovery tool](ftp://ftp.avm.de/fritz.box/fritzbox.7362_sl/x_misc/deutsch/fritz.box_7362_sl.06.20.recover-image.exe), στην συνέχεια ξεκίνησα να ψάχνω για Wine ή παρόμοιους emulators των Windows στο Mac. Ε, μετά από λίγο, βρήκα έναν, και το όνομα αυτού: [WineBottler](http://winebottler.kronenberg.org/).

Με βαρυά καρδιά ξεκίνησα το κατέβασμα. Λέω με "βαρυά", γιατί τότε διαπίστωτα ότι το μέγεθος του `dmg` ήταν περίπου 150MB, το οποίο δεν είναι και ότι καλύτερο για το συμβόλαιο που έχω σχετικά με το *mobile internet*. Μάλιστα, λίγο πριν τελειώσει, μου ήρθε mail πως έχω λιγότερο από 25% προς χρήση, οπότε ήξερα ότι θα μου έμεναν MB για πολύ ακόμα...

### Mediasensing
Συνδέω λοιπόν το fritz!box στο Mac μέσω Ethernet και τρέχω το πρόγραμμα με το Wine. Βρε απο δω, βρε απο κει ... τίποτα! Έβγαζε συνέχεια ένα μήνυμα για Γερμανικά να απενεργοποιήσω το "mediasensing". Τι σκατά είναι το "mediasensing" ρε παιδια; Τέλος πάντων, μην τα πολυλογώ... βρήκα [aυτό το θαυμασίο](http://www.ip-phone-forum.de/showthread.php?t=264115) post σε ένα forum όπου λέει ότι η συγκεκριμένη επιλογή, απενεργοποιείται μέσω της Registry, πειράζοντας το `SYSTEM\\CurrentControlSet\\Services\\TcpIp\ \Parameters" /v DisableDHCPMediaSense /t REG_DWORD /d 0x1"`. Όντως λοιπόν, πηγαίνω στις ρυθμήσεις το Wine > `Registry Editor` και ενεργοποιώ την επιλογή.

> Seriously, μόνο σε μένα έκανε εντύπωση ότι το Wine έχει πλέον και Registry Editor;

### Error 13
Μόλις το έκανα αυτό, το error εξαφανίστηκε, και το πρόγραμμα άρχισε να φορτώνει... Αλλά (ναι κι αλλο πρόβλημα) αυτή την φορά ξεκινάει το πρόγραμμα, αλλά μου βγάζει να επιλέξω network interface στο οποίο έχω συνδέσει το router. Thankfully, η παλιά καλή εντολή `ifconfig` έκανε το θαύμα της, και είδα ότι το thunderbolt δουλεύει για ρόλο της `en02`. Οπότε, επιλέγω αυτή, πατάω *Weiter* και περιμενω... καθώς περιμένω, ανοίγω το Wireshark και βλέπω ότι το πρόγραμμα στέλνει broadcast μηνύματα στο συγκεκριμένο Interface. Καμία απάντηση από το Router... το κόκκινο LED συνεχίζει να αναβοσβήνει ακάθεκτο. Σκέφτομαι λοιπόν να κλείσω και να ανοίξω το Router για μία ακόμα φορά. Ο λόγος είναι γιατί θυμήθηκα ότι στην αρχή, παραμένει το Power για 4-5 δευτερόλεπτα και μετά γίνεται παλι Info (κοκκινο). Οπότε μπορεί για αυτά τα 5-6 δευτερόλεπτα που παραμένει στο πράσινο LED, να μπορέσει να δώσει IP αν την ίδια στιγμή έχει ένα χαζό πρόγραμμα που τρέχει σε WINE και το πρίζει να κάνει `acknowledgement` σε κάποιο από τα μυνήματά του.

> Και όντως έδωσε...`169.254.1.1`

Αρχίζει λοιπόν να φορτώνει μία μπάρα και να γράφει κάτι στα Γερμανικά! "Ωραία λέω, τελείωσαν τα βάσανα!", αλλά ... (ναι πάλι "αλλά).

```bash
Recovery läuft auf mtd1 durch.
Dann Fehler bei "Restaurierung mtd3" ; Fehler WinError-13 
Das Recovery Programm bricht dann komplett ab.
```

Μετά από καμιά 10αρια αποτυχημένες προσπάθειες, έπεσα πάνω [σ'αυτό](http://www.router-faq.de/index.php?id=fb&fb=recover#l1) το thread. Εδώ λοιπόν λένε, να δώσω καρφωτά IP και να μην περιμένω τον DHCP. Ετσι κ έκανα:

+ IP-Adresse: `192.168.178.2`
+ Subnetzmaske: `255.255.255.0`
+ Standardgateway: `192.168.178.1`
+ Bevorzugter DNS-Server: `192.168.178.1`

Εκτός από αυτό, ένα παλικάρι συμβούλευε να δοκιμάσουμε να συνδεθούμε και στην `Port B` αντί της `Port A` που κάνει αναφορά το manual.

Προφανώς, μόλις πάτησα το `apply` το Router δεν έδωσε σημεία ζωής στην συγκεκριμένη διεύθυνση. Οπότε άνοιξα πάλι το *recover tool*, και μόλις ξεκίνησε να στέλνε broadcast, έβαλα/εβγαλα το ρεύμα στο Fritz!Box. Όντως, μετά από λίγα δευτερόλεπτα, το εντόπισε και ξεκίνησε το scan. Αυτή την φορά πήγε ένα βήμα παραπέρα, αλλά πάλι έβγαλε το ίδιο σφάλμα.

Παίζοντας λίγο με το `TCP Optimizer` (ένα [πρόγραμμα](http://www.router-faq.de/index.php?id=programme&prog=tcpoptimizer)) πάλι για Windows, με βοήθησε να ρυθμήσω τον ρυθμό μετάδοσης. Αρχισα λοιπόν να παίζω σε Half-Duplex και με διαφορετικά MTU. Όταν το έβαλα όμως στο αυτόματο και προσπάθησα ξανά ... το recovery tool δούλεψε!

## Φλασάρισμα
Έχοντας πλέον πρόσβαση στον πίνακα ελέγχου του Fritz!Box, πήγα και του πέρασα manually το καινούριο firmware. Για να το κάνω αυτό, έπρεπε να ενεργοποιήσω την επιλογή `Ansicht: Erweitert` ώστε να βλέπω περισσότερες πληροφορίες, διαφορετικά το μόνο που σου είχε είναι το Online Update. Πάω λοιπόν `Sicherung` > `Wiederherstellen` και ανεβάζω το `*.image` αρχείο. 

**Εννοείται** πως κατά την διάρκεια το φλασαρίσματος, είχα συνδεμένο το Fritz!Box με το Macbook μέσω Ethernet και δεν το ξεσύνδεσα παρά μόνο όταν τελείωσε και ολοκληρώθηκε ολόκληρη η διαδικασία.

## Τέλος καλό, Internet όμως;


Για κακή μου τύχη, είχα αλλάξει τον κωδικό με τον οποίο κάνω Login στην 1und1. Οχι δεν τον ξέχασα, τον θυμάμαι μια χαρά. Το πρόβλημα είναι ότι για να συνδεθείς στο Internet (και να λειτουργήσει και το τηλέφωνο), το Fritz!Box σου ζητάει ένα StartCode, ο οποίος κωδικός γίνεται generate **κάθε φορά που αλλάζεις password**. Για μία ακόμα φορά, το κινητό έσωσε την κατάσταση. Μπήκα στο 1und1 login center, αλλαξα τον κώδικο, κι στο καπάκι μου έστειλαν τον νέο StartCode με τον οποίο μπόρεσα και ενεργοποιήσα τόσο το Internet όσο και το τηλέφωνο.

-----------------------

Ηθικό Δίδαγμα:
Ποτέ, μα ποτέ, μα ποτέ μην βάλετε το Router σας να κάνει αυτόματα update το firmware. Έπαθα ότι έπαθα, γιατί το Fritz!Box κάθε βράδυ στις 00:00 ψάχνει να βρει αν υπάρχει κάποια νεοτερη έκδοση. Απόψε λοιπόν βρήκε, προσπάθησε να την εφαρμόσει, δεν τα κατάφερε, και κόλλησε...
